version: '3.8'

services:
    otel-collector:
      image: otel/opentelemetry-collector-contrib:0.82.0
      restart: always
      container_name: otel-collector
      command:
        - --config=/etc/otelcol-contrib/otel-collector.yml
      volumes:
        - ./otel-collector.yml:/etc/otelcol-contrib/otel-collector.yml
      ports:
        - "1888:1888" 
        - "8888:8888"
        - "8889:8889"
        - "13133:13133"
        - "4317:4317"
        - "4318:4318"
        - "55679:55679"
      depends_on:
        - jaeger-all-in-one
        - zipkin-all-in-one

    prometheus:
      container_name: prometheus
      image: prom/prometheus
      restart: always
      command:
        - --config.file=/etc/prometheus/prometheus.yml
      volumes:
        - ./prometheus.yml:/etc/prometheus/prometheus.yml
      ports:
        - "9090:9090"

    loki:
      image: grafana/loki:latest
      command: -config.file=/etc/loki/local-config.yaml
      ports:
        - "3100:3100"

    tempo:
      image: grafana/tempo:latest
      command: [ "-config.file=/etc/tempo.yml" ]
      volumes:
        - ./tempo.yml:/etc/tempo.yml
      ports:
        - "3200:3200"
        - "4317"

    grafana:
      container_name: grafana
      image: grafana/grafana
      volumes:
      - ./grafana-datasources.yml:/etc/grafana/provisioning/datasources/datasources.yml
      ports:
        - "3000:3000"

    jaeger-all-in-one:
      image: jaegertracing/all-in-one:latest
      restart: always
      ports:
        - "16686:16686"
        - "14268"
        - "14250"

    zipkin-all-in-one:
      image: openzipkin/zipkin:latest
      restart: always
      ports:
        - "9411:9411"